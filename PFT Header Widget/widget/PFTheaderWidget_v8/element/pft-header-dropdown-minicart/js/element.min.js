define(["jquery","knockout","pubsub"],function(e,t,n){"use strict";return{elementName:"pft-header-dropdown-minicart",displayedMiniCartItems:t.observableArray(),currentSection:t.observable(1),totalSections:t.observable(),dropdowncartItemsHeight:t.observable(),gwpQualifiedMessage:t.observable(),onLoad:function(r){var i=this;r.hasOwnProperty("miniCartNumberOfItems")&&(r.miniCartNumberOfItems()===undefined&&r.miniCartNumberOfItems(3),r.miniCartNumberOfItems(parseInt(r.miniCartNumberOfItems())),r.computeDropdowncartHeight=function(){var t=e("#CC-PFTheaderWidget #dropdowncart .item").css("height");t?(t=t.split("p"),t=parseInt(t[0])):t=80,i.dropdowncartItemsHeight(r.miniCartNumberOfItems()*t+24),i.dropdowncartItemsHeight(i.dropdowncartItemsHeight()+"px")},i.totalSections=t.computed(function(){return r.cart().allItems().length==0?0:Math.ceil(r.cart().allItems().length/r.miniCartNumberOfItems())},r),r.miniCartScrollDown=function(){r.cartOpenTimeout&&clearTimeout(r.cartOpenTimeout),i.currentSection(i.currentSection()+1),r.computeMiniCartItems(),i.displayedMiniCartItems()[0]&&e("#CC-header-dropdown-minicart-image-"+i.displayedMiniCartItems()[0].productId+i.displayedMiniCartItems()[0].catRefId).focus()},r.miniCartScrollUp=function(){r.cartOpenTimeout&&clearTimeout(r.cartOpenTimeout),i.currentSection(i.currentSection()-1),r.computeMiniCartItems(),i.displayedMiniCartItems()[0]&&e("#CC-header-dropdown-minicart-image-"+i.displayedMiniCartItems()[0].productId+i.displayedMiniCartItems()[0].catRefId).focus()},r.computeMiniCartItems=function(){i.currentSection()<=i.totalSections()?i.displayedMiniCartItems(r.cart().allItems().slice((i.currentSection()-1)*r.miniCartNumberOfItems(),i.currentSection()*r.miniCartNumberOfItems())):i.totalSections()?(i.displayedMiniCartItems(r.cart().allItems().slice((i.totalSections()-1)*r.miniCartNumberOfItems(),i.totalSections()*r.miniCartNumberOfItems())),i.currentSection(i.totalSections())):(i.displayedMiniCartItems.removeAll(),i.currentSection(1))},r.goToProductInDropDownCart=function(t){r.computeMiniCartItems();var n=t.childSKUs[0].repositoryId,s=r.cart().allItems(),o=-1;e(".cc-cartlink-anchor").focus();if(r.displayMiniCart()){for(var u=0;u<s.length;u++)if(t.id==s[u].productId&&s[u].catRefId==n){o=u;break}if(o>-1){r.showDropDownCart();var a=Math.floor(o/r.miniCartNumberOfItems()),f=o%r.miniCartNumberOfItems();i.currentSection(a+1),r.computeMiniCartItems(),e("#CC-header-dropdown-minicart-image-"+t.id+n).focus(),r.cartOpenTimeout=setTimeout(function(){r.hideDropDownCart(),e(".cc-cartlink-anchor").focus()},r.miniCartDuration()*1e3)}}},e.Topic(n.topicNames.CART_ADD_SUCCESS).subscribe(r.goToProductInDropDownCart),e.Topic(n.topicNames.CART_REMOVE_SUCCESS).subscribe(r.computeMiniCartItems),e.Topic(n.topicNames.CART_UPDATE_QUANTITY_SUCCESS).subscribe(r.computeMiniCartItems),e.Topic(n.topicNames.CART_UPDATED).subscribe(r.computeMiniCartItems),e.Topic(n.topicNames.GWP_QUALIFIED_MESSAGE).subscribe(function(e){r["pft-header-dropdown-minicart"].gwpQualifiedMessage(e.summary)}),e.Topic(n.topicNames.GWP_CLEAR_QUALIFIED_MESSAGE).subscribe(function(){r["pft-header-dropdown-minicart"].gwpQualifiedMessage(null)}))}}})