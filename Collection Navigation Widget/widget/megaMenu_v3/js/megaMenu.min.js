define(["knockout","ccConstants","notifications","pubsub","CCi18n","spinner"],function(e,t,n,r,i,s){"use strict";return{categories:e.observableArray(),catalogMenuBlock:"#CC-megaMenu",menuOptions:{parent:"#CC-megaMenu",posTop:"40px",posLeft:"30%"},onLoad:function(t){t.categories.isData=!0,t.menuName="CC-CategoryNav",t.isMobile=e.observable(!1),$(window).resize(function(){t.checkResponsiveFeatures($(window).width())}),$(document).on("mouseover","li.cc-desktop-dropdown",function(){$(this).children("ul.dropdown-menu").css({display:"block",top:"auto"}),navigator.userAgent.indexOf("Firefox")!=-1?$("#CC-product-listing-sortby-controls select.form-control").hide():$("#CC-product-listing-sortby-controls select.form-control").css("visibility","hidden")}),$(document).on("mouseout","li.cc-desktop-dropdown",function(){$(this).children("ul.dropdown-menu").css({display:"none"}),navigator.userAgent.indexOf("Firefox")!=-1?$("#CC-product-listing-sortby-controls select.form-control").show():$("#CC-product-listing-sortby-controls select.form-control").css("visibility","visible")}),$(document).on("keydown","a.Level1",function(e){e.which===9&&e.shiftKey?$(this).next("ul.dropdown-menu").css({display:"none"}):e.which==27?$(this).next("ul.dropdown-menu").css({display:"none"}):e.which==9?$(this).next().children("a.Level2").parents("ul.dropdown-menu").css({display:"block",top:"auto"}):e.which==13&&$(this).next("ul.dropdown-menu").css({display:"none"})}),$(document).on("keydown","a.Level2",function(e){e.which==27?$(this).parents("ul.dropdown-menu").css({display:"none"}):e.which==9?$(this).next().children("a.Level3").parents("ul.dropdown-menu").css({display:"block",top:"auto"}):e.which==13&&$(this).parents("ul.dropdown-menu").css({display:"none"})}),$(document).on("keydown","a.Level3",function(e){e.which==27?$(this).parents("ul.dropdown-menu").css({display:"none"}):e.which==9?$(this).parent("li").next("li").children("a.Level3").length==0&&$(this).parents("div.child-category-container").next("div.child-category-container").children("a.Level2").length==0&&$(this).parents("ul.dropdown-menu").parent("li.cc-desktop-dropdown").next("li.cc-desktop-dropdown").focus():e.which==13&&navigator.userAgent.indexOf("MSIE")==-1&&!navigator.userAgent.match(/Trident.*rv\:11\./)&&$(this).parents("ul.dropdown-menu").css({display:"none"})}),$(document).on("blur","a.Level3",function(e){$(this).parent("li").next("li").children("a.Level3").length==0&&$(this).parents("div.child-category-container").next("div.child-category-container").children("a.Level2").length==0&&$(this).parents("ul.dropdown-menu").css({display:"none"})}),$(document).on("focus","li.cc-desktop-dropdown",function(){$(this).children("ul.dropdown-menu").css({display:"block",top:"auto"})}),t.user()!=undefined&&t.user().catalogId&&t.catalogId(t.user().catalogId()),t.setCategoryList()},beforeAppear:function(t){var n=this;e.isObservable(n.user)&&n.user()&&e.isObservable(n.user().catalogId)&&n.user().catalogId()&&n.user().catalogId()!=n.catalogId()&&(n.categories(""),n.createSpinner(),n.catalogId(n.user().catalogId()),n.setCategoryList(),n.destroySpinner())},setCategoryList:function(){var e=this;e.load("categoryList",[e.rootCategoryId(),e.catalogId(),1e3,e.fields()],function(t){e.checkResponsiveFeatures($(window).width());var n,r,i,s;n=1,i=t.length,s=parseInt(e.maxNoOfElements(),1e3),i>s&&(i=s,t=t.slice(0,s));for(r=0;r<i;r+=1)e.setUiIdentifier(t[r],e.menuName,n,r,e.navigationCategoryClick,s),e.setAriaLabelText(t[r]);e.categories(t)},e)},destroySpinner:function(){var e=this;$(e.catalogMenuBlock).removeClass("loadingIndicator"),s.destroy(1)},createSpinner:function(){var e=this;$(e.catalogMenuBlock).css("position","relative"),e.menuOptions.loadingText="Loading",s.create(e.menuOptions)},catMenuClick:function(e,t){return $.Topic(r.topicNames.OVERLAYED_GUIDEDNAVIGATION_HIDE).publish([{message:"success"}]),$.Topic(r.topicNames.UPDATE_FOCUS).publishWith({WIDGET_ID:"productListing"},[{message:"success"}]),!0},checkResponsiveFeatures:function(e){e>978?this.isMobile(!1):e<=978&&this.isMobile(!0)},setUiIdentifier:function(e,t,n,r,i,s){var o,u,a,f;e.uiIdentifier=t+"_"+(r+1).toString(),e.level=n,e.itemIndex=r+1,e.hasChildCategories=!1,e.levelClass="Level"+n.toString(),e.subSubmenuClickFunc=i,o=e.childCategories;if(typeof o!="undefined"&&o!==null){e.hasChildCategories=!0,f=o.length,f>s&&(f=s,e.childCategories=e.childCategories.slice(0,s));for(var l=0;l<f;l+=1)a=e.childCategories[l],this.setUiIdentifier(a,t+"_"+(r+1).toString(),n+1,l,i,s),this.setAriaLabelText(a)}},setAriaLabelText:function(e){var t=e.childCategories;typeof t!="undefined"&&t!==null?e.ariaLabelText=i.t("ns.megaMenu:resources.categoryNavScreenReaderText",{categoryLength:t.length,displayName:e.displayName}):e.ariaLabelText=i.t("ns.megaMenu:resources.noSubCategoriesText",{displayName:e.displayName})},navigationCategoryClick:function(e,t){n.emptyGrowlMessages();var r,i;t.stopPropagation(),r=$(t.target).parent("li"),i=r.parent().parent(),$(t.target).parent().hasClass("dropdown-submenu")&&t.preventDefault();if(r.hasClass("open"))r.removeClass("open").addClass("closed");else if(i.hasClass("open")){$(".dropdown-submenu.open").removeClass("open").addClass("closed");if(r.hasClass("closed"))return r.removeClass("closed").addClass("open"),!1;r.removeClass("open").addClass("closed")}return!0},megaMenuClick:function(e,t){return n.emptyGrowlMessages(),$.Topic(r.topicNames.OVERLAYED_GUIDEDNAVIGATION_HIDE).publish([{message:"success"}]),t.stopPropagation(),!0}}})